window.addEventListener("load",()=>{let t=false;let l=[];const a=document.getElementById("search-mask");const e=()=>{const e=document.body.style;e.width="100%";e.overflow="hidden";anzhiyu.animateIn(a,"to_show 0.5s");anzhiyu.animateIn(document.querySelector("#local-search .search-dialog"),"titleScale 0.5s");setTimeout(()=>{document.querySelector("#local-search-input input").focus()},100);if(!t){o();t=true}document.addEventListener("keydown",function e(t){if(t.code==="Escape"){s();document.removeEventListener("keydown",e)}})};const s=()=>{const e=document.body.style;e.width="";e.overflow="";anzhiyu.animateOut(document.querySelector("#local-search .search-dialog"),"search_close .5s");anzhiyu.animateOut(a,"to_hide 0.5s")};const n=()=>{document.querySelector("#search-button > .search").addEventListener("click",e);document.querySelector("#menu-search").addEventListener("click",e)};const c=()=>{document.querySelector("#local-search .search-close-button").addEventListener("click",s);a.addEventListener("click",s);if(GLOBAL_CONFIG.localSearch.preload)l=i(GLOBAL_CONFIG.localSearch.path)};const r=e=>{const t=/\.json$/;return t.test(e)};const i=async e=>{let t=[];const a=await fetch(e);if(r(e)){t=await a.json()}else{const l=await a.text();const s=await(new window.DOMParser).parseFromString(l,"text/xml");const n=await s;t=[...n.querySelectorAll("entry")].map(e=>{let a=[];if(e.querySelector("tags")&&e.querySelector("tags").getElementsByTagName("tag")){Array.prototype.forEach.call(e.querySelector("tags").getElementsByTagName("tag"),function(e,t){a.push(e.textContent)})}let t=e.querySelector("content")&&e.querySelector("content").textContent;let l=/<img.*?(?:>|\/>)/gi;let s=/src=[\'\"]?([^\'\"]*)[\'\"]?/i;let n=t.match(l);let c=[];if(n){for(let t=0;t<n.length;t++){let e=n[t].match(s);if(!e[1].indexOf("http"))c.push(e[1])}}return{title:e.querySelector("title").textContent,content:t,url:e.querySelector("url").textContent,tags:a,oneImage:c&&c[0]}})}if(a.ok){const c=document.getElementById("loading-database");c.nextElementSibling.style.display="block";c.remove()}return t};const o=()=>{if(!GLOBAL_CONFIG.localSearch.preload){l=i(GLOBAL_CONFIG.localSearch.path)}const e=document.querySelector("#local-search-input input");const t=document.getElementById("local-search-results");const a=document.getElementById("loading-status");e.addEventListener("input",function(){const h=this.value.trim().toLowerCase().split(/[\s]+/);if(h[0]!=="")a.innerHTML='<i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i>';t.innerHTML="";let f='<div class="search-result-list">';if(h.length<=0)return;let m=0;l.then(e=>{e.forEach(e=>{let a=true;let n=e.title?e.title.trim().toLowerCase():"";let c=e.tags;let r=e.oneImage??"";const i=e.content?e.content.trim().replace(/<[^>]+>/g,"").toLowerCase():"";const o=e.url.startsWith("/")?e.url:GLOBAL_CONFIG.root+e.url;let l=-1;let s=-1;let d=-1;if(n!==""||i!==""){h.forEach((e,t)=>{l=n.indexOf(e);s=i.indexOf(e);if(l<0&&s<0){a=false}else{if(s<0){s=0}if(t===0){d=s}}})}else{a=false}if(a){if(d>=0){let e=d-30;let t=d+100;let a="";let l="";if(e<0){e=0}if(e===0){t=100}else{a="..."}if(t>i.length){t=i.length}else{l="..."}let s=i.substring(e,t);h.forEach(e=>{const t=new RegExp(e,"gi");s=s.replace(t,'<span class="search-keyword">'+e+"</span>");n=n.replace(t,'<span class="search-keyword">'+e+"</span>")});f+='<div class="local-search__hit-item">';if(r){f+=`<div class="search-left"><img src=${r} alt=${n} data-fancybox='gallery'>`}else{f+='<div class="search-left" style="width:0">'}f+="</div>";if(r){f+='<div class="search-right"><a href="'+o+'" class="search-result-title">'+n+"</a>"}else{f+='<div class="search-right" style="width: 100%"><a href="'+o+'" class="search-result-title">'+n+"</a>"}m+=1;if(i!==""){f+='<p class="search-result" onclick="pjax.loadUrl(`'+o+'`)">'+a+s+l+"</p>"}if(c.length){f+='<div class="search-result-tags">';for(let e=0;e<c.length;e++){const u=c[e].trim();f+='<a class="tag-list" href="/tags/'+u+'/" data-pjax-state="" one-link-mark="yes">#'+u+"</a>"}f+="</div>"}}f+="</div></div>"}});if(m===0){f+='<div id="local-search__hits-empty">'+GLOBAL_CONFIG.localSearch.languages.hits_empty.replace(/\$\{query}/,this.value.trim())+"</div>"}f+="</div>";t.innerHTML=f;if(h[0]!=="")a.innerHTML="";window.pjax&&window.pjax.refresh(t)})})};n();c();window.addEventListener("pjax:complete",()=>{!anzhiyu.isHidden(a)&&s();n()})});
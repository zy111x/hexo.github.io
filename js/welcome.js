const addStyles=()=>{const n=document.createElement("style");n.textContent="\n    .item-content {\n      margin: 5px 0 10px 0;\n    }\n    #welcome-info {\n      user-select: none;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      height: 212px;\n      padding: 10px;\n      border-radius: 8px;\n      background-color: var(--anzhiyu-background);\n      outline: 1px solid var(--anzhiyu-card-border);\n    }\n    .loading-spinner {\n      width: 50px;\n      height: 50px;\n      border: 3px solid rgba(0, 0, 0, 0.1);\n      border-radius: 50%;\n      border-top: 3px solid var(--anzhiyu-main);\n      animation: spin 1s linear infinite;\n    }\n    @keyframes spin {\n      0% { transform: rotate(0deg); }\n      100% { transform: rotate(360deg); }\n    }\n    .ip-address {\n      filter: blur(5px);\n      transition: filter 0.3s ease;\n    }\n    .ip-address:hover {\n      filter: blur(0);\n    }\n    .error-message {\n      color: #ff6565;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n    }\n    .error-message p,\n    .permission-dialog p {\n      margin: 0;\n    }\n    .error-icon {\n      font-size: 3rem;\n    }\n    #retry-button {\n      margin: 0 5px;\n      color: var(--anzhiyu-main);\n      transition: transform 0.3s ease;\n    }\n    #retry-button:hover {\n      transform: rotate(180deg);\n    }\n    .permission-dialog {\n      text-align: center;\n    }\n    .permission-dialog button {\n      margin: 10px 5px;\n      padding: 5px 10px;\n      border: none;\n      border-radius: 5px;\n      background-color: var(--anzhiyu-main);\n      color: white;\n      transition: opacity 0.3s ease;\n    }\n    .permission-dialog button:hover {\n      opacity: 0.8;\n    }\n  ",document.head.appendChild(n)},createAnnouncementComponent=()=>{const n=document.createElement("div");return n.classList.add("card-widget","card-ip-info"),n.innerHTML='\n    <div class="item-headline">\n      <i class="fa-solid fa-user-large" style="font-size: 18px;color: red;"></i>\n      <span>欢迎来访者！</span>\n    </div>\n    <div class="item-content">\n      👋🏻 Hi，我是胜天半子，欢迎你！<br>\n      ❓ 如有问题欢迎评论区交流！<br>\n      😫 页面异常？尝试<kbd>Ctrl</kbd>+<kbd>F5</kbd><br>\n      📧 如需联系我：<a href="mailto:ruoms@qq.com"><b>发送邮件🚀</b></a>\n    </div>\n    <div id="welcome-info">\n      <div class="loading-spinner"></div>\n    </div>\n  ',n},insertAnnouncementComponent=()=>{if(!isHomePage())return;const n=document.querySelector(".card-widget.card-info");if(n){const e=document.querySelector(".card-widget.card-ip-info");e?.remove(),n.parentNode.insertBefore(createAnnouncementComponent(),n.nextSibling)}},checkLocationPermission=()=>"granted"===localStorage.getItem("locationPermission"),saveLocationPermission=n=>{localStorage.setItem("locationPermission",n)},showLocationPermissionDialog=()=>{document.getElementById("welcome-info").innerHTML='\n    <div class="permission-dialog">\n      <div class="error-icon">❓</div>\n      <p>是否允许访问您的位置信息？</p>\n      <button id="allow-location">允许</button>\n      <button id="deny-location">拒绝</button>\n    </div>\n  ';const n=n=>{saveLocationPermission(n),"granted"===n?(showLoadingSpinner(),fetchIpInfo()):showErrorMessage("您已拒绝访问位置信息")};document.getElementById("allow-location").addEventListener("click",(()=>n("granted"))),document.getElementById("deny-location").addEventListener("click",(()=>n("denied")))},showLoadingSpinner=()=>{document.getElementById("welcome-info").innerHTML='<div class="loading-spinner"></div>'},fetchIpInfo=async()=>{if(checkLocationPermission()){showLoadingSpinner();try{const n=await fetch("https://api.76.al/api/ip/query?key=nReEyBliaeyvx29CX2SG4Zgd38");if(!n.ok)throw new Error("网络响应不正常");const e=await n.json();showWelcome(e)}catch(n){console.error("错误:",n),showErrorMessage()}}else showLocationPermissionDialog()},getDistance=(n,e,t,o)=>{const i=n=>n*Math.PI/180,[a,r]=[e,o].map(i),[s,l]=[o-e,t-n].map(i),d=Math.sin(s/2)**2+Math.cos(a)*Math.cos(r)*Math.sin(l/2)**2,c=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d));return Math.round(6371*c)},greetings={"中国":{"北京市":"北——京——欢迎你~~~","天津市":"讲段相声吧","河北省":"山势巍巍成壁垒，天下雄关铁马金戈由此向，无限江山","山西省":"展开坐具长三尺，已占山河五百余","内蒙古自治区":"天苍苍，野茫茫，风吹草低见牛羊","辽宁省":"我想吃烤鸡架！","吉林省":"状元阁就是东北烧烤之王","黑龙江省":"很喜欢哈尔滨大剧院","上海市":"众所周知，中国只有两个城市","江苏省":{"南京市":"这是我挺想去的城市啦","苏州市":"上有天堂，下有苏杭",default:"散装是必须要散装的"},"浙江省":{"杭州市":"东风渐绿西湖柳，雁已还人未南归",default:"望海楼明照曙霞,护江堤白蹋晴沙"},"河南省":{"郑州市":"豫州之域，天地之中","信阳市":"品信阳毛尖，悟人间芳华","南阳市":"臣本布衣，躬耕于南阳此南阳非彼南阳！","驻马店市":"峰峰有奇石，石石挟仙气嵖岈山的花很美哦！","开封市":"刚正不阿包青天","洛阳市":"洛阳牡丹甲天下",default:"可否带我品尝河南烩面啦？"},"安徽省":"蚌埠住了，芜湖起飞","福建省":"井邑白云间，岩城远带山","江西省":"落霞与孤鹜齐飞，秋水共长天一色","山东省":"遥望齐州九点烟，一泓海水杯中泻","湖北省":{"黄冈市":"红安将军县！辈出将才！",default:"来碗热干面~"},"湖南省":"74751，长沙斯塔克","广东省":{"广州市":"看小蛮腰，喝早茶了嘛~","深圳市":"今天你逛商场了嘛~","阳江市":"阳春合水！博主家乡~ 欢迎来玩~",default:"来两斤福建人~"},"广西壮族自治区":"桂林山水甲天下","海南省":"朝观日出逐白浪，夕看云起收霞光","四川省":"康康川妹子","贵州省":"茅台，学生，再塞200","云南省":"玉龙飞舞云缠绕，万仞冰川直耸天","西藏自治区":"躺在茫茫草原上，仰望蓝天","陕西省":"来份臊子面加馍","甘肃省":"羌笛何须怨杨柳，春风不度玉门关","青海省":"牛肉干和老酸奶都好好吃","宁夏回族自治区":"大漠孤烟直，长河落日圆","新疆维吾尔自治区":"驼铃古道丝绸路，胡马犹闻唐汉风","台湾省":"我在这头，大陆在那头","香港特别行政区":"永定贼有残留地鬼嚎，迎击光非岁玉","澳门特别行政区":"性感荷官，在线发牌",default:"带我去你的城市逛逛吧！"},"美国":"Let us live in peace!","日本":"よろしく、一緒に桜を見ませんか","俄罗斯":"干了这瓶伏特加！","法国":"C'est La Vie","德国":"Die Zeit verging im Fluge.","澳大利亚":"一起去大堡礁吧！","加拿大":"拾起一片枫叶赠予你",default:"带我去你的国家逛逛吧"},getGreeting=(n,e,t)=>{const o=greetings[n]||greetings.default;if("string"==typeof o)return o;const i=o[e]||o.default;return"string"==typeof i?i:i[t]||i.default},getTimeGreeting=()=>{const n=(new Date).getHours();return n<11?"早上好🌤️ ，一日之计在于晨":n<13?"中午好☀️ ，记得午休喔~":n<17?"下午好🕞 ，饮茶先啦！":n<19?"即将下班🚶‍♂️，记得按时吃饭~":"晚上好🌙 ，夜生活嗨起来！"},showWelcome=({data:n,ip:e})=>{if(!n)return showErrorMessage();const{lng:t,lat:o,country:i,prov:a,city:r,district:s}=n,l=getDistance(121.524012,38.882522,t,o),d=e.includes(":")?"<br>好复杂，咱看不懂~(ipv6)":e,c="中国"===i?`${a} ${r} ${s}`:i,m=getGreeting(i,a,r),g=getTimeGreeting(),p=document.getElementById("welcome-info");p.style.display="block",p.style.height="auto",p.innerHTML=`\n    欢迎来自 <b>${c}</b> 的小友💖<br>\n    当前位置距博主约 <b>${l}</b> 公里！<br>\n    你的IP地址：<b class="ip-address">${d}</b><br>\n    ${g}<br>\n    <b>Tips😋：${m}🍂</b>\n    <div id="time-spent"><b>友情提示🥳：</b>您已经浏览该网页 <timing></timing></div>\x3c!-- 加入友情提示 --\x3e</br>  `,startTimer()},showErrorMessage=(n="抱歉，无法获取信息")=>{document.getElementById("welcome-info").innerHTML=`\n    <div class="error-message">\n      <div class="error-icon">😕</div>\n      <p>${n}</p>\n      <p>请<i id="retry-button" class="fa-solid fa-arrows-rotate"></i>重试或检查网络连接</p>\n    </div>\n  `,document.getElementById("retry-button").addEventListener("click",fetchIpInfo)},handlePjaxComplete=()=>{insertAnnouncementComponent(),isHomePage()&&fetchIpInfo()},isHomePage=()=>"/"===window.location.pathname||"/index.html"===window.location.pathname,initialize=()=>{addStyles(),insertAnnouncementComponent(),isHomePage()&&fetchIpInfo(),document.addEventListener("pjax:complete",handlePjaxComplete)};window.onload=initialize;let localhostTime,oSpan=document.getElementsByTagName("timing")[0];function tow(n){return n>=0&&n<10?"0"+n:""+n}localStorage.getItem("localhostTime")?localhostTime=new Date(parseInt(localStorage.getItem("localhostTime"))):(localhostTime=new Date,localStorage.setItem("localhostTime",localhostTime.getTime().toString())),setInterval((function(){let n=(new Date).getTime()-localhostTime.getTime(),e=Math.floor(n/1e3),t=Math.floor(e/3600);e%=3600;let o=Math.floor(e/60);e%=60;var i=tow(t)+'<span class="time">小时</span>'+tow(o)+'<span class="time">分钟</span>'+tow(e)+'<span class="time">秒</span>';oSpan.innerHTML=i}),1e3);